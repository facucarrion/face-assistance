---
import Layout from '../layout/Layout.astro'
---

<Layout>
  <header class='flex justify-between items-center p-4 bg-gray-200'>
    <button id='home-button' class='flex items-center text-white'>
      <img src='/logo.svg' alt='Logo' class='h-20 mr-4' />
    </button>

    <div class='flex space-x-2'>
      <button
        id='button'
        class='bg-gray-200 text-black font-semibold px-4 py-2 rounded-lg hover:bg-gray-400'
        >Gestionar</button
      >
      <div class='relative'>
        <input
          id='search-input'
          type='text'
          placeholder='Buscar alumnos'
          class='bg-gray-200 text-black font-semibold px-4 py-2 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500'
        />
        <button id='search-button' class='absolute right-0 top-0 mt-2 mr-2'>
          <img src='/search.svg' alt='Buscar' class='h-6 w-6' />
        </button>
      </div>
    </div>
  </header>

  <h1 id='greeting' class='text-3xl text-black-500 font-bold'></h1>

  <section>
    <h2 class='text-2xl font-semibold mb-4'>Cursos</h2>
    <ul id='groups-list' class='grid grid-cols-3 gap-4'></ul>
  </section>
</Layout>

<script>
  const greeting = document.getElementById('greeting') as HTMLHeadingElement

  async function fetchGroups() {
    try {
      const response = await fetch('http://localhost:8000/groups')
      if (!response.ok) {
        throw new Error('Network response was not ok')
      }
      const groups = await response.json()
      renderGroups(groups)
    } catch (error) {
      console.error('There was a problem with the fetch operation:', error)
    }
  }

  function renderGroups(groups) {
    const groupsList = document.getElementById('groups-list')
    groupsList.innerHTML = ''
    groups.forEach(group => {
      const listItem = document.createElement('li')
      listItem.textContent = group.name
      listItem.classList.add(
        'bg-white',
        'p-4',
        'rounded-lg',
        'shadow-md',
        'cursor-pointer',
        'hover:bg-gray-200',
        'transition',
        'transform',
        'hover:scale-105',
        'text-center'
      )
      listItem.onclick = () => {
        window.location.href = `/groups/${group.id_group}`
      }
      groupsList.appendChild(listItem)
    })
  }

  document.addEventListener('DOMContentLoaded', () => {
    fetchGroups()

    const button = document.getElementById('button')
    const homeButton = document.getElementById('home-button')

    button.addEventListener('click', () => {
      window.location.href = '/manage'
    })

    homeButton.addEventListener('click', () => {
      window.location.href = '/'
    })
  })
</script>
